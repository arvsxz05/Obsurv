{% load static %}
<html>
<head>
	<title>Obsurv</title>
	<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="{% static 'css/materialize.min.css' %}">
	<link rel="stylesheet" href="{% static 'css/materialize.clockpicker.css' %}">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
	
	<div class="navbar-fixed">
		<nav>
			<div class="nav-wrapper">
				<a href="#!" class="brand-logo">Logo</a>
				<a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">menu</i></a>
				<ul class="right hide-on-med-and-down">
					<li><a href="sass.html">Sass</a></li>
					<li><a href="badges.html">Components</a></li>
					<li><a href="collapsible.html">Javascript</a></li>
					<li><a href="mobile.html">Mobile</a></li>
				</ul>
				<ul class="side-nav" id="mobile-demo">
					<li><a href="sass.html">Sass</a></li>
					<li><a href="badges.html">Components</a></li>
					<li><a href="collapsible.html">Javascript</a></li>
					<li><a href="mobile.html">Mobile</a></li>
				</ul>
			</div>
		</nav>
	</div>
	<center><h1>Welcome to Obsurv, {{ request.user.username }}</h1></center>
	<div class="row container">
		<form action = "{% url 'post_poll' %}" method="POST">
			{% csrf_token %}
			<div class="card">
				<div class="card-content container">
					<div class="input-field">
			            <textarea id="textarea1" name="question" class="materialize-textarea" data-length="200">{{ question }}</textarea>
			            <label for="textarea1">Write Question</label>
		          	</div>
		          	<input type="hidden" id="no_of_choices" name="no_of_choices" value="0">
		        	<ul id="choices_space">
		        		<li>
		        			<div class="input-field">
			        			<i class="material-icons prefix">input</i>
			        			<input placeholder="Enter a Choice" id="id0" name="id0" type="text" oninput="blurFunction()" onblur="blurFunction()">
			        		</div>
			        	</li>
		        	</ul>
		        	<div class="row">
			        	<div class="input-field col s12 m6">
		   					<input type="date" id="end-date" class="datepicker" name="end_date">
		   					<label for="end-date">End Date</label>
		   				</div>
		   				<div class="input-field col s12 m6">
	                        <label for="end_time">End Time</label>
	                        <input id="end_time" class="timepicker" name="end_time" type="time">
                    	</div>
	   				</div>
		        	<p>
						<input type="checkbox" class="filled-in" id="filled-in-box" name="multiple"/>
						<label for="filled-in-box">Multiple Answer</label>
	   				</p>
	   				
	   				{{ error }}
			    </div>
			    <div class="card-action">
					<button class="waves-effect waves-light btn"><i class="material-icons left">assessment</i>Create Poll</button>
				</div>
			</div>
		</form>
	</div>
	
	{% for temp_question in questions %}
        <div class="row">
			<div class="col s12 m6">
				<div class="card blue-grey darken-1">
					<form method="POST">
						{% csrf_token %}
						<div class="card-content white-text">
							<span class="card-title">{{ temp_question.user_owner.username }}</span>
							<p>{{ temp_question.question_text }}</p>
							{% for single_choice in temp_question.Choices.all %}
								<p>
									<input class="with-gap" name="response" type="radio" id="{{ single_choice.pk }}"  />
									<label for="{{ single_choice.pk }}">"{{ single_choice.choice_text }}"</label>
								</p>
							{% endfor %}
						</div>
						<div class="card-action">
							<button class="waves-effect waves-light btn"><i class="material-icons left">assessment</i>Respond</button>
						</div>
					</form>
				</div>
			</div>
    	</div>
    {% endfor %}
    <script type="text/javascript">
    	function blurFunction () {
    		var choices_space = document.getElementById("choices_space");
    		var list_items = choices_space.children;
    		var li_value;
    		var j=0;
	    	for (var i = 0; i < list_items.length; i++) {
	    		li_value = list_items[i].children[0].children[1].value;
	    		if((li_value == undefined || li_value.trim() == "") && i != list_items.length-1) {
	    			list_items[i].remove();
	    		} else {
	    			list_items[i].children[0].children[1].id = "id" + j;
	    			list_items[i].children[0].children[1].name = "id" + j;
	    			j++;
	    		}
	    	};
	    	if (li_value != undefined && li_value.trim() != "") {
	    		
	    		var cln = choices_space.children[list_items.length-1];
	    		// console.log("here");
	    		child = cln.cloneNode(true);
	    		child.children[0].children[1].value = "";
	    		choices_space.appendChild(child);
	    		j++;
	    	}
	    	
	    	document.getElementById("no_of_choices").value = j;
	    	if(document.getElementById("choices_space").lastChild.children[0].children[1].value.trim() == "") {
	    		document.getElementById("no_of_choices").value = j-1;
	    	}
	    	console.log(document.getElementById("no_of_choices").value);
    	}
    	
    </script>

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="{% static 'js/materialize.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/materialize.clockpicker.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/home.js' %}"></script>
</body>
</html>