{% extends "base.html" %}

{% block styles %}
    <style type="text/css">
    	.card[disabled] {
    		opacity: 0.7;
    	}
    </style>
{% endblock %}

{% block content %}
	<div class="row container">
		<form action = "{% url 'index' %}" method="POST">
			{% csrf_token %}
			<div class="card">
				<div class="card-content container">
					<span class="card-title">Create Poll</span>
					<div class="input-field">
			            <textarea id="textarea1" name="question" class="materialize-textarea" data-length="200">{{ question }}</textarea>
			            <label for="textarea1">Write Question</label>
		          	</div>
		          	<input type="hidden" id="no_of_choices" name="no_of_choices" value="0">
		        	<ul id="choices_space">
		        		<li>
		        			<div class="input-field">
			        			<i class="material-icons prefix">input</i>
			        			<input placeholder="Enter a Choice" id="id0" name="id0" type="text" oninput="blurFunction()" onblur="blurFunction()">
			        		</div>
			        	</li>
		        	</ul>
		        	<div class="row">
			        	<div class="input-field col s12 m6">
		   					<input id="end-date" class="datepicker" name="end_date" type="date" required>
		   					<label for="end-date">End Date</label>
		   				</div>
		   				<div class="input-field col s12 m6">
	                        <label for="end_time">End Time</label>
	                        <input id="end_time" class="timepicker" name="end_time" type="time" required>
                    	</div>
	   				</div>
		        	<p>
						<input type="checkbox" class="filled-in" id="filled-in-box" name="multiple"/>
						<label for="filled-in-box">Multiple Answer</label>
	   				</p>
	   				
	   				 <span class="red-text">{{ error }}</span>
			    </div>
			    <div class="card-action">
					<button class="waves-effect waves-light btn"><i class="material-icons left">assessment</i>Create Poll</button>
				</div>
			</div>
		</form>
	</div>
	<div class="container">
	{% for temp_question1, temp_question2 in questions %}
        <div class="row">
			<div class="col s12 m6">
				<div class="card blue-grey darken-1">
					<form>
						<!-- {% csrf_token %} -->
						<div class="card-content white-text">
							<span class="card-title">
								<div class="row valign-wrapper">
									<div class="col s2">
							        	<img src="{{ temp_question1.user_owner.profile.avatar_url }}" alt="" class="circle responsive-img"> <!-- notice the "circle" class -->
							        </div>
							        <div class="col s10">
										{{ temp_question1.user_owner.username }}
										<h6 class="grey-text text-lighten-2">{{ temp_question1.when_created }}</h6>
									</div>
								</div>
							</span>
							<p>{{ temp_question1.question_text }}</p>
							{% for single_choice in temp_question1.Choices.all %}
								<p>
									<input class="with-gap" name="response" type="radio" id="{{ single_choice.pk }}" value="{{ single_choice.pk }}"/>
									<label for="{{ single_choice.pk }}">"{{ single_choice.choice_text }}"</label>
								</p>
							{% endfor %}
						</div>
						<div class="card-action">
							<button class="waves-effect waves-light btn"><i class="material-icons left">assessment</i>Respond</button>
							<span class="right white-text"><i class="material-icons left">supervisor_account</i>{{ temp_question1.no_of_respondents }}</span>
						</div>
					</form>
				</div>
			</div>
			{% if temp_question2 %}
			<div class="col s12 m6">
				<div class="card blue-grey darken-1">
					<form>
						<!-- {% csrf_token %} -->
						<div class="card-content white-text">
							<span class="card-title">
								<div class="row valign-wrapper">
									<div class="col s2">
							        	<img src="{{ temp_question2.user_owner.profile.avatar_url }}" alt="" class="circle responsive-img"> <!-- notice the "circle" class -->
							        </div>
							        <div class="col s10">
										{{ temp_question2.user_owner.username }}
										<h6 class="grey-text text-lighten-2">{{ temp_question2.when_created }}</h6>
									</div>
								</div>
							</span>
							<p>{{ temp_question2.question_text }}</p>
							{% for single_choice in temp_question2.Choices.all %}
								<p>
									<input class="with-gap" name="response" type="radio" id="{{ single_choice.pk }}" value="{{ single_choice.pk }}"/>
									<label for="{{ single_choice.pk }}">"{{ single_choice.choice_text }}"</label>
								</p>
							{% endfor %}
						</div>
						<div class="card-action">
							<button class="waves-effect waves-light btn"><i class="material-icons left">assessment</i>Respond</button>
							<span class="right white-text"><i class="material-icons left">supervisor_account</i>{{ temp_question2.no_of_respondents }}</span>
						</div>
					</form>
				</div>
			</div>
			{% endif %}
    	</div>
    {% endfor %}
    </div>
{% endblock %}

{% block js %}
	{% load static %}
	<script type="text/javascript" src="{% static 'js/home.js' %}"></script>
    <script type="text/javascript">
    	function blurFunction () {
    		var choices_space = document.getElementById("choices_space");
    		var list_items = choices_space.children;
    		var li_value;
    		var j=0;
	    	for (var i = 0; i < list_items.length; i++) {
	    		li_value = list_items[i].children[0].children[1].value;
	    		if((li_value == undefined || li_value.trim() == "") && i != list_items.length-1) {
	    			list_items[i].remove();
	    		} else {
	    			list_items[i].children[0].children[1].id = "id" + j;
	    			list_items[i].children[0].children[1].name = "id" + j;
	    			j++;
	    		}
	    	};
	    	if (li_value != undefined && li_value.trim() != "") {
	    		
	    		var cln = choices_space.children[list_items.length-1];
	    		// console.log("here");
	    		child = cln.cloneNode(true);
	    		child.children[0].children[1].value = "";
	    		choices_space.appendChild(child);
	    		j++;
	    	}
	    	
	    	document.getElementById("no_of_choices").value = j;
	    	if(document.getElementById("choices_space").lastChild.children[0].children[1].value.trim() == "") {
	    		document.getElementById("no_of_choices").value = j-1;
	    	}
	    	console.log(document.getElementById("no_of_choices").value);
    	}
    </script>
{% endblock %}